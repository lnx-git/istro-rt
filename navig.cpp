#include <stdio.h>
#include <string.h>
#include "config.h"    // ANGLE_NONE
#include "navig.h"
#include "logger.h"

LOG_DEFINE(loggerNavig, "navig");

/*
const int    NAVIGATION_POINT_COUNT = 53;

// Stadthallenpark, Donaupark - Deggendorf, Germany
nav_point_t navigationPoint[NAVIGATION_POINT_COUNT] = 
{
    { "S1", 12.953862, 48.831845 },
    { "S2", 12.954119, 48.831137 },  // 12.953937, 48.831319
    { "S3", 12.955238, 48.831391 },  // 12.955182, 48.831469
    { "S4", 12.953513, 48.831021 },
    { "S5", 12.954579, 48.830662 },
    { "S6", 12.955850, 48.830800 },
    { "S7", 12.955427, 48.830341 },
    { "S8", 12.955757, 48.830244 },
    { "S9", 12.953706, 48.831526 },   
    { "D1", 12.947022, 48.830155 },
    { "D2", 12.948826, 48.829476 },
    { "D3", 12.949395, 48.829627 },
    { "D4", 12.950198, 48.829489 },
    { "D5", 12.950473, 48.828940 },
    { "D6", 12.951154, 48.829502 },
    { "D7", 12.952034, 48.829152 },
    { "D8", 12.951915, 48.828520 },
    { "E1", 12.952387, 48.829002 },
    { "E2", 12.952375, 48.828375 },
    { "E3", 12.954186, 48.828293 },
    { "E4", 12.953667, 48.828025 },
    { "E5", 12.954769, 48.827630 },
    { "E6", 12.954907, 48.827692 },
    { "E7", 12.955546, 48.827998 },
    { "E8", 12.954755, 48.828094 },
    { "T2", 12.947434, 48.831111 },
    { "T3", 12.948204, 48.830859 },
    { "T4", 12.949861, 48.830289 },
    { "T5", 12.952034, 48.829546 },
    { "T6", 12.952056, 48.829873 },
    { "T7", 12.951233, 48.830236 },
    { "T8", 12.950480, 48.830395 },
    { "T9", 12.949389, 48.830718 },
    { "U1", 12.948465, 48.831000 },
    { "U2", 12.947419, 48.831269 },
    { "U3", 12.952234, 48.829874 },
    { "U4", 12.952252, 48.829401 }, 
    { "U5", 12.952398, 48.829346 },
    { "U6", 12.952705, 48.829677 },
    { "U7", 12.953120, 48.830094 },
    { "X1", 12.952982, 48.830332 },
    { "X2", 12.952754, 48.829835 },
    { "X3", 12.952593, 48.829354 },
    { "X4", 12.955396, 48.828405 },
    { "X5", 12.955496, 48.831775 },
    { "X6", 12.956611, 48.831461 },
    { "X7", 12.956999, 48.831245 },
    { "X8", 12.957402, 48.831143 },
    { "C1", 12.953991, 48.830386 },
    { "C2", 12.953790, 48.830156 },
    { "C3", 12.956299, 48.829545 },
    { "C4", 12.956114, 48.829319 },
    { "C5", 12.954895, 48.829917 }  
};
*/

const int    NAVIGATION_POINT_COUNT = 40+1;

// park Ostredky - Bratislava, Slovakia
nav_point_t navigationPoint[NAVIGATION_POINT_COUNT] = 
{
    { "W1", 17.169618, 48.161310 },
    { "W2", 17.170065, 48.161682 },
    { "W3", 17.170130, 48.161353 },
    { "W4", 17.170518, 48.161735 },
    { "W5", 17.170805, 48.161335 },
    { "W6", 17.171084, 48.161548 },  // mimo krizovatky
    { "W7", 17.171186, 48.161370 },  // mimo krizovatky
    { "W8", 17.171371, 48.161596 },
    { "W9", 17.171711, 48.161613 },
    { "E1", 17.167659, 48.161307 },
    { "E2", 17.167464, 48.161237 },
    { "E3", 17.167484, 48.161490 },  // mimo krizovatky
    { "E4", 17.167109, 48.161464 },
    { "E5", 17.166185, 48.160976 },
    { "E6", 17.166060, 48.161250 },
    { "E7", 17.165812, 48.161238 },    
    { "E8", 17.165820, 48.161356 },
    { "E9", 17.165418, 48.161327 },
    { "M1", 17.168734, 48.161694 },
    { "M2", 17.169385, 48.161374 },
    { "M3", 17.168833, 48.161326 },
    { "M4", 17.168187, 48.161371 },
    { "M5", 17.167968, 48.161354 },
    { "M6", 17.167940, 48.161532 },
    { "M7", 17.167997, 48.161190 },
    { "N1", 17.165371, 48.161540 },
    { "N2", 17.166198, 48.161598 },
    { "N3", 17.166851, 48.161648 },
    { "N4", 17.168001, 48.161734 },
    { "N5", 17.168718, 48.161796 },
    { "N6", 17.170058, 48.161889 },
    { "N7", 17.170906, 48.161932 },
    { "N8", 17.171685, 48.161992 },
    { "S1", 17.165506, 48.160784 },
    { "S2", 17.166208, 48.160844 },
    { "S3", 17.167919, 48.160967 },
    { "S4", 17.169293, 48.161072 },
    { "S5", 17.170171, 48.161143 },
    { "S6", 17.170874, 48.161198 },
    { "S7", 17.171887, 48.161260 },
    { "XX", 17.038773, 48.234771 }    // ba-krce.xml
};

int navigation_next_point(const char *path, int &pos, double &point_latitude, double &point_longitude)
{
    int ll = strlen(path);

    point_latitude = ANGLE_NONE;
    point_longitude = ANGLE_NONE;
    
    if (pos < ll - 1) {
        for(int idx = 0; idx < NAVIGATION_POINT_COUNT; idx++) {
            if ((navigationPoint[idx].name[0] == path[pos]) && (navigationPoint[idx].name[1] == path[pos+1])) {
                LOGM_INFO(loggerNavig, "navigation_next_point", "found!, name=\"" << navigationPoint[idx].name << "\", pos=" << pos
                    << ", lat=" << ioff(navigationPoint[idx].latitude, 6) << ", lon=" << ioff(navigationPoint[idx].longitude, 6));                
                pos += 2;
                point_latitude = navigationPoint[idx].latitude;
                point_longitude = navigationPoint[idx].longitude;
                return 0;
            }
        }
    }

    LOGM_INFO(loggerNavig, "navigation_next_point", "not found!, pos=" << pos);

    return -1;
}
